{% extends "base.html" %}
{% load static %}
{% block title %}{{ note.title }}{% endblock %} | 笔记

{% block css %}
<link rel="stylesheet" href="{% static '/wangeditor/wangeditor.min.css' %}">
<link rel="stylesheet" href="{% static '/Notebook/css/notebook_theme.css' %}">
<style>
    :focus-visible{outline: none;}
    #editor_container a{text-decoration: underline;}
</style>
{% endblock %}

{% block content %}
<!-- 顶栏 -->
<div class="sticky-top bg-light border-bottom">
    <div class="container">
        <div class="row">
            <nav class="navbar navbar-light ">
                <a href="{% url 'Notebook_directory_notelist' note.directory.id%}" class="col-2 text-start ps-2">
                    <i class="text-success bi bi-arrow-left-short" style="font-size: 1.5rem;"></i>
                    <i class="text-success bi bi-journal-text" style="font-size: 1.5rem;"></i>
                </a>
                <span class="col-8 h5 text-center" style="margin: 0px;">笔记详情</span>
                <a data-bs-toggle="offcanvas" href="#toolbarBottom" class="col-2 text-end pe-2">
                    <i class="text-success bi bi-gear-wide-connected" style="font-size: 1.5rem;"></i>
                </a>
            </nav>
        </div>
    </div>
</div>

<div id="editor_container" class="container"></div>

<!-- 工具栏 -->
<div class="offcanvas offcanvas-bottom" data-bs-focus="false" style="height: 50%;" tabindex="-1" id="toolbarBottom">
    <div class="offcanvas-header row border-bottom d-flex justify-content-between">
        <h4 class="offcanvas-title col-10" id="toolbarBottomLabel"><i class="bi bi-file-earmark-richtext text-success"></i> {{ note.title }}</h4>
        <button type="button" class="btn-close me-3" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <div class="container">
            <div class="row mb-3">
                <div class="col-3 ps-1 pe-1">
                    <a href="{% url 'Notebook_note_edit' note.id%}" class="card pt-2 pb-2 text-center text-success">
                        <i class="bi bi-pen" style="font-size: 2rem;"></i>
                        <small>编辑</small>
                    </a>
                </div>
                <div class="col-3 ps-1 pe-1">
                    <a href="#modal_change_directory" data-bs-toggle="modal" class="card pt-2 pb-2 text-center text-primary">
                        <i class="bi bi-pin-map" style="font-size: 2rem;"></i>
                        <small>移动</small>
                    </a>
                </div>
                <div class="col-3 ps-1 pe-1">
                    <div href="#" class="card pt-2 pb-2 text-center text-secondary">
                        <i class="bi bi-alarm-fill" style="font-size: 2rem;"></i>
                        <small>*没做*</small>
                    </div>
                </div>
                <div class="col-3 ps-1 pe-1">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#deleteConfirm" class="card pt-2 pb-2 text-center text-danger">
                        <i class="bi bi-trash-fill" style="font-size: 2rem;"></i>
                        <small>删除</small>
                    </a>
                </div>
            </div>
            <ul class="list-group mb-3">
                <div class="list-group-item">
                    <div class="form-check form-switch">
                        <label class="form-check-label">置顶</label>
                        <input id="switch_pintop" class="form-check-input" type="checkbox" role="switch" {% if note.isPinTop %}checked{% endif %}>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="form-check form-switch">
                        <label class="form-check-label">待编辑</label>
                        <input id="switch_pending" class="form-check-input" type="checkbox" role="switch" {% if note.isPending %}checked{% endif %}>
                    </div>
                </div>
            </ul>
            <ul class="list-group mb-3">
                <div class="list-group-item">
                    <small class="text-success">最后编辑时间：<br></small>
                    {{ note.editDate }}
                </div>
                <div class="list-group-item">
                    <small class="text-success">笔记创建时间：<br></small>
                    {{ note.createDate }}
                </div>
            </ul>
        </div>
    </div>
</div>

<!-- 删除确认 -->
<div class="modal fade" id="deleteConfirm" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">确认删除？</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                删除的笔记将在回收站中保留30天（注：还没做这个功能，删了就是真删了）。
            </div>
            <div class="modal-footer">
                <a class="btn btn-danger" href="{% url 'api_Notebook_note_delete' note.id %}">确认</a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>

<!-- 更换目录 -->
<div class="modal fade" id="modal_change_directory" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">移动笔记至：</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row mt-3">
                        <div class="col">
                            <ul class="list-group list-group-flush">
                                {% if root_dir.first_child %}
                                    {% with dir=root_dir.first_child %}
                                        {% include 'Notebook/note/detail_createChangeDirTree.html' with dir=dir %}
                                    {% endwith%}
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
<script src="{% static '/wangeditor/wangeditor.min.js' %}"></script>
<script>
    note_content = `{{note.content|escape}}`
    url_api_note_switch_pintop = "{% url 'api_Notebook_note_switch_pintop' note.id %}"
    url_api_note_switch_pending = "{% url 'api_Notebook_note_switch_pending' note.id %}"
</script>
<script src="{% static '/Notebook/js/note_detail.js' %}"></script>
{% endblock %}